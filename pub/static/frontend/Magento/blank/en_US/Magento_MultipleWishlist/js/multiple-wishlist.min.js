define(["jquery",'mage/template',"mage/validation/url",'Magento_Ui/js/modal/alert','Magento_Ui/js/modal/confirm',"mage/validation/validation","jquery/ui","mage/translate","mage/dataPost","mage/dropdowns"],function($,mageTemplate,urlValidator,alert,confirm){'use strict';$.widget('mage.multipleWishlist',{options:{createTmplSelector:'#popup-tmpl',createTmplData:{btnCloseClass:'close',popupWishlistBlockId:'create-wishlist-block',popupWishlistFormId:'create-wishlist-form',url:'#',isPublic:false,isEdit:false},errorMsg:$.mage.__('We can\'t create the Wish List right now.'),spinnerClass:'loading'},_create:function(){var _this=this;this.element.on('click','[data-wishlist-create]',function(){var json=$(this).data('wishlist-create'),url=json['url']?json['url']:_this.options.createUrl,isAjax=json['ajax'];_this._showCreateWishlist(url,isAjax);return false;});},_showCreateWishlist:function(url,isAjax){this.createTmpl?this.createTmpl.show():this._initCreateTmpl();$('#'+this.options.createTmplData.popupWishlistFormId).attr('action',url);this.createAjax=isAjax;},_initCreateTmpl:function(){this.createTmpl=$(mageTemplate(this.options.createTmplSelector,{data:this.options.createTmplData}));this.createTmpl.on('click','.'+this.options.createTmplData.btnCloseClass,$.proxy(function(){this.createTmpl.hide();},this)).appendTo('body');$('#'+this.options.createTmplData.popupWishlistFormId).on('submit',$.proxy(function(event){var form=event.target;if(this.createAjax){event.preventDefault();this._createWishlistAjax(form);}else{form.submit();}},this));},_createWishlistAjax:function(form){var _form=$(form),_this=this;$.ajax({url:_form.attr('action'),type:'post',cache:false,data:_form.serialize(),beforeSend:function(){$('#'+_this.options.createTmplData.popupWishlistBlockId).addClass(_this.options.spinnerClass);},success:function(response){if(typeof response['wishlist_id']!=='undefined'){if(_this._callback){_this._callback(response.wishlist_id);}}else if(typeof response['redirect']!=='undefined'){urlValidator.redirect(response.redirect);}else{alert({content:_this.options.errorMsg});}}});}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{options:{wishlistFormSelector:'#wishlist-view-form',formTmplSelector:'#form-tmpl-multiple',formTmplId:'#wishlist-hidden-form'},_create:function(){this._super();this.moveWishlistJson=this.element.find('[data-wishlist-move]').data('wishlist-move');this.element.on('click','[data-wishlist-move-selected]',$.proxy(this._moveSelectedTo,this));this.element.on('click','[data-wishlist-move-item]',$.proxy(this._moveItemTo,this));},_moveItemTo:function(e){var json=$(e.currentTarget).data('wishlist-move-item'),tmplJson={qty:this._getQty($(e.currentTarget)),itemId:json['itemId'],url:this.moveWishlistJson.moveItemUrl};if(json['new']){this._moveItemToNew(tmplJson);}else{tmplJson.wishlistId=json['wishlistId'];$(mageTemplate(this.options.formTmplSelector,{data:tmplJson})).appendTo('body');$(this.options.formTmplId).submit();}},_getQty:function(elem){var qty=elem.closest('div.product-item-info').find('input.qty');return qty.length?qty[0].value:null;},_moveSelectedTo:function(e){var json=$(e.currentTarget).data('wishlist-move-selected'),wishlistId=json['wishlistId'];if(!this._itemsSelected()){alert({content:$.mage.__('Please select items to move.')});return;}
if(json['new']){this._moveSelectedToNew();}else{var url=this.moveWishlistJson.moveSelectedUrl.replace("%wishlist_id%",wishlistId);$(this.options.wishlistFormSelector).attr('action',url).submit();}},_moveSelectedToNew:function(url){this._callback=function(wishlistId){var _url=(url||this.moveWishlistJson.moveSelectedUrl).replace("%wishlist_id%",wishlistId);$(this.options.wishlistFormSelector).attr('action',_url).submit();};this._showCreateWishlist(this.options.createUrl,true);},_moveItemToNew:function(tmplJson){this._callback=function(wishlistId){tmplJson.wishlistId=wishlistId;$(mageTemplate(this.options.formTmplSelector,{data:tmplJson})).appendTo('body');$(this.options.formTmplId).submit();};this._showCreateWishlist(this.options.createUrl,true);},_itemsSelected:function(){return $(this.options.wishlistFormSelector).find('input.checkbox:checked').length?true:false;}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{_create:function(){this._super();this.copyWishlistJson=this.element.find('[data-wishlist-copy]').data('wishlist-copy');this.element.on('click','[data-wishlist-copy-selected]',$.proxy(this._copySelectedTo,this));this.element.on('click','[data-wishlist-copy-item]',$.proxy(this._copyItemTo,this));},_copyItemTo:function(e){var json=$(e.currentTarget).data('wishlist-copy-item'),tmplJson={qty:this._getQty($(e.currentTarget)),itemId:json['itemId'],url:this.copyWishlistJson.copyItemUrl};if(json['new']){this._copyItemToNew(tmplJson);}else{tmplJson.wishlistId=json['wishlistId'];$(mageTemplate(this.options.formTmplSelector,{data:tmplJson})).appendTo('body');$(this.options.formTmplId).submit();}},_copySelectedTo:function(e){var json=$(e.currentTarget).data('wishlist-copy-selected'),wishlistId=json['wishlistId'];if(!this._itemsSelected()){alert({content:$.mage.__('Please select items to copy.')});return;}
if(json['new']){this._copySelectedToNew();}else{var url=this.copyWishlistJson.copySelectedUrl.replace("%wishlist_id%",wishlistId);$(this.options.wishlistFormSelector).attr('action',url).submit();}},_copySelectedToNew:function(){this._moveSelectedToNew(this.copyWishlistJson.copySelectedUrl);},_copyItemToNew:function(tmplJson){this._moveItemToNew(tmplJson);}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{options:{deleteMsg:$.mage.__('Are you sure you want to delete your wish list? This action can\'t be undone.')},_create:function(){this._super();this.element.on('click','[data-wishlist-delete]',$.proxy(this._deleteWishlist,this));},_deleteWishlist:function(e){var json;e.preventDefault();confirm({content:this.options.deleteMsg,actions:{confirm:function(){json=$(e.currentTarget).data('wishlist-delete');$.ajax({url:json['deleteUrl'].replace('%item%',json['wishlistId']),type:'post',cache:false,success:function(){window.location.href=json['redirectUrl'];}});}}});}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{options:{editTmplSelector:'#popup-tmpl',editTmplData:{btnCloseClass:'close',popupWishlistBlockId:'edit-wishlist-block',popupWishlistFormId:'edit-wishlist-form',isEdit:true}},_create:function(){this._super();this.element.on('click','[data-wishlist-edit]',$.proxy(this._editWishlist,this));},_editWishlist:function(e){var json=$(e.currentTarget).data('wishlist-edit');this.options.editTmplData.url=json['url'];this.options.editTmplData.name=json['name'];this.options.editTmplData.isPublic=json['isPublic'];this.editTmpl?this.editTmpl.show():this._initEditTmpl();return false;},_initEditTmpl:function(){this.editTmpl=$(mageTemplate(this.options.editTmplSelector,{data:this.options.editTmplData}));this.editTmpl.on('click','.'+this.options.editTmplData.btnCloseClass,$.proxy(function(){this.editTmpl.hide();},this)).appendTo('body');$('#'+this.options.editTmplData.popupWishlistFormId).validation();}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{options:{wishlistLink:'.link-wishlist',splitBtnTmpl:'#split-btn-tmpl'},_create:function(){this._super();this.element.on('click','[data-post-new-wishlist]',$.proxy(function(e){var data=$(e.currentTarget).data('post-new-wishlist');$.extend(true,data,$(e.currentTarget).data('post'));this._addToNew(data);},this));this._buildWishlistDropdown();},_addToNew:function(data){this._callback=$.proxy(function(wishlistId){data.data.wishlist_id=wishlistId;$.mage.dataPost().postData(data);},this);this._showCreateWishlist(this.options.createUrl,true);},_buildWishlistDropdown:function(){if(this.options.wishlists&&this.options.wishlists.length>0){$(this.options.wishlistLink).each($.proxy(function(index,e){var element=$(e),buttonName=element.text().trim(),generalParams=element.data('post'),tmplData={wishlists:[],generalParams:generalParams,buttonName:buttonName};for(var i=0;i<this.options.wishlists.length;i++){var currentData=$.extend({},generalParams.data,{wishlist_id:this.options.wishlists[i].id}),currentParams={action:generalParams.action,data:currentData};tmplData.wishlists.push({name:this.options.wishlists[i].name,params:currentParams});}
if(this.options.canCreate){tmplData.wishlists.push({newClass:'new',name:'Create New Wish List',params:generalParams});}
$(mageTemplate(this.options.splitBtnTmpl,{data:tmplData})).prependTo(element.parent());element.parent().trigger('contentUpdated');element.remove();},this));}}});$.widget('mage.multipleWishlist',$.mage.multipleWishlist,{_create:function(){this._super();var _this=this;this.element.on('click','[data-wishlist-to-giftregistry]',function(){var json=$(this).data('wishlist-to-giftregistry'),tmplJson={item:json['itemId'],entity:json['entity'],url:json['url']};$(mageTemplate(_this.options.formTmplSelector,{data:tmplJson})).appendTo('body');$(_this.options.formTmplId).submit();});}});return $.mage.multipleWishlist;});