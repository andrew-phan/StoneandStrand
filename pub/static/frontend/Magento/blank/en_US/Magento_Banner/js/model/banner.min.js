define(['jquery','underscore','ko','jquery/jquery-storageapi'],function($,_,ko){'use strict';var options,storage=$.initNamespaceStorage('mage-banners-cache-storage').localStorage,invalidateCacheBySessionTimeOut=function(){var date=new Date();if(new Date($.localStorage.get('mage-banners-cache-timeout'))<new Date()){date=new Date(Date.now()+30*1000);storage.removeAll();$.localStorage.set('mage-banners-cache-timeout',date);}},dataProvider={getFromStorage:function(sectionNames){var result={};_.each(sectionNames,function(sectionName){result[sectionName]=storage.get(sectionName);});return result;},getFromServer:function(sectionNames){var parameters=_.isArray(sectionNames)?{sections:sectionNames.join(',')}:[];return $.getJSON(options.sectionLoadUrl,parameters).fail(function(jqXHR){throw new Error(jqXHR);});}},buffer={data:{},bind:function(sectionName){this.data[sectionName]=ko.observable({});},get:function(sectionName){if(!this.data[sectionName]){this.bind(sectionName);}
return this.data[sectionName];},keys:function(){return _.keys(this.data);},notify:function(sectionName,sectionData){if(!this.data[sectionName]){this.bind(sectionName);}
this.data[sectionName](sectionData);},update:function(sections){_.each(sections,function(sectionData,sectionName){storage.set(sectionName,sectionData);buffer.notify(sectionName,sectionData);});}},banner={init:function(){if(_.isEmpty(storage.keys())){this.reload([]);}else{_.each(dataProvider.getFromStorage(storage.keys()),function(sectionData,sectionName){buffer.notify(sectionName,sectionData);});}},get:function(sectionName){return buffer.get(sectionName);},set:function(sectionName,sectionData){var data={};data[sectionName]=sectionData;buffer.update(data);},reload:function(sectionNames){return dataProvider.getFromServer(sectionNames).done(function(sections){buffer.update(sections);});},'Magento_Banner/js/model/banner':function(settings){options=settings;invalidateCacheBySessionTimeOut(settings);banner.init();}};$.cookieStorage.setConf({path:'/'});return banner;});